<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hebrew Flashcards</title>
  <link rel="manifest" href="manifest.json">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Rubik+Microbe&family=Assistant&family=David+Libre&family=Frank+Ruhl+Libre&family=Varela+Round&display=swap');

    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      margin: 0;
    }

    #flashcard-container {
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 20px 0;
    }

    .card {
      width: 260px;
      height: 300px;
      perspective: 1000px;
      cursor: pointer;
    }

    .inner-card {
      width: 100%;
      height: 100%;
      transition: transform 0.6s;
      transform-style: preserve-3d;
      position: relative;
    }

    .card.flipped .inner-card {
      transform: rotateY(180deg);
    }

    .front, .back {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
      border-radius: 12px;
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
      padding: 20px;
      text-align: center;
    }

    .front {
      background: white;
      color: #222;
      font-size: 4em;
    }

    .back {
      background: #0077cc;
      color: white;
      transform: rotateY(180deg);
      flex-direction: column;
    }

    .sofit {
      font-size: 1.3em;
      color: #ffd700;
      margin: 6px 0;
    }

    .example {
      font-size: 0.9em;
      color: #cce6ff;
    }

    #controls {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
      margin-bottom: 15px;
    }

    button {
      padding: 10px 14px;
      font-size: 1em;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }

    #correct-btn { background-color: #4CAF50; color: white; }
    #wrong-btn { background-color: #f44336; color: white; }
    #settings-btn, #speak-btn { background: #333; color: white; }
    #import-btn, #export-btn { background: #666; color: white; }

    #settings-menu {
      display: none;
      margin-top: 15px;
      background: white;
      padding: 15px;
      border-radius: 10px;
      width: 90%;
      max-width: 400px;
      box-shadow: 0 0 10px rgba(0,0,0,0.15);
    }

    textarea, input[type="color"], select, input[type="file"] {
      width: 100%;
      padding: 8px;
      margin-top: 6px;
    }

    @media (max-width: 600px) {
      .card {
        width: 90vw;
        height: 260px;
      }

      .front {
        font-size: 3em;
      }

      #settings-menu {
        width: 95%;
      }
    }
  </style>
<link rel="apple-touch-icon" sizes="180x180" href="icon-180.png">
</head>
<body>

  <div id="flashcard-container"></div>

  <div id="controls">
    <button id="correct-btn">‚úÖ Correct</button>
    <button id="wrong-btn">‚ùå Wrong</button>
    <button id="speak-btn">üîä Speak</button>
    <button id="settings-btn">‚öôÔ∏è Settings</button>
    <button id="export-btn">üì§ Export</button>
    <button id="import-btn">üì• Import</button>
    <input type="file" id="importFile" accept=".json" style="display:none;">
  </div>

  <div id="settings-menu">
    <label>Card Front Color: <input type="color" id="frontColor" value="#ffffff"></label>
    <label>Card Back Color: <input type="color" id="backColor" value="#0077cc"></label>
    <label>Exclude Fonts:
      <select multiple id="excludedFonts">
        <option value="'Rubik Microbe', cursive">Rubik Microbe</option>
        <option value="'Assistant', sans-serif">Assistant</option>
        <option value="'David Libre', serif">David Libre</option>
        <option value="'Frank Ruhl Libre', serif">Frank Ruhl Libre</option>
        <option value="'Varela Round', sans-serif">Varela Round</option>
      </select>
    </label>
    <label>Add New Card (JSON):
      <textarea id="newCard" placeholder='{"hebrew":"◊ñ", "name":"Zayin", "sound":"Z", "example":"Zebra"}'></textarea>
    </label>
    <button onclick="addNewCard()">‚ûï Add Card</button>
  </div>

  <script>
    const fonts = [
      "'Rubik Microbe', cursive",
      "'Assistant', sans-serif",
      "'David Libre', serif",
      "'Frank Ruhl Libre', serif",
      "'Varela Round', sans-serif"
    ];

    let defaultCards = [
      { hebrew: '◊ê', name: 'Aleph', sound: 'Silent', example: 'Uh-oh' },
      { hebrew: '◊ë', name: 'Bet', sound: 'B/V', example: 'Boy / Vet' },
      { hebrew: '◊õ', name: 'Kaf', sound: 'K', example: 'King', sofit: '◊ö' },
      { hebrew: '◊û', name: 'Mem', sound: 'M', example: 'Man', sofit: '◊ù' },
      { hebrew: '◊†', name: 'Nun', sound: 'N', example: 'Net', sofit: '◊ü' },
      { hebrew: '◊§', name: 'Pe', sound: 'P/F', example: 'Pen / Fun', sofit: '◊£' },
      { hebrew: '◊¶', name: 'Tsadi', sound: 'Ts', example: 'Cats', sofit: '◊•' }
    ];

    let cards = JSON.parse(localStorage.getItem('hebrewCards') || JSON.stringify(defaultCards));
    let stats = {};
    let currentCard = null;

    function pickNextCard() {
      const weights = cards.map(card => {
        const key = card.hebrew;
        const fail = stats[key]?.fail || 0;
        const pass = stats[key]?.pass || 0;
        return 1 + fail - pass * 0.5;
      });
      const total = weights.reduce((a, b) => a + b, 0);
      const rand = Math.random() * total;
      let sum = 0;
      for (let i = 0; i < cards.length; i++) {
        sum += weights[i];
        if (rand < sum) return cards[i];
      }
      return cards[0];
    }

    function renderCard(card) {
      currentCard = card;
      const container = document.getElementById('flashcard-container');
      container.innerHTML = '';

      const excluded = Array.from(document.getElementById('excludedFonts').selectedOptions).map(o => o.value);
      const availableFonts = fonts.filter(f => !excluded.includes(f));
      const font = availableFonts[Math.floor(Math.random() * availableFonts.length)];
      const frontColor = document.getElementById('frontColor').value;
      const backColor = document.getElementById('backColor').value;

      const cardEl = document.createElement('div');
      cardEl.className = 'card';
      const inner = document.createElement('div');
      inner.className = 'inner-card';

      const front = document.createElement('div');
      front.className = 'front';
      front.style.fontFamily = font;
      front.style.background = frontColor;
      front.textContent = card.hebrew;

      const back = document.createElement('div');
      back.className = 'back';
      back.style.background = backColor;
      back.innerHTML = `
        <strong>${card.name}</strong>
        <div>${card.sound}</div>
        ${card.sofit ? `<div class="sofit">Final: ${card.sofit}</div>` : ''}
        <div class="example">Ex: ${card.example}</div>
      `;

      inner.appendChild(front);
      inner.appendChild(back);
      cardEl.appendChild(inner);
      cardEl.addEventListener('click', () => cardEl.classList.toggle('flipped'));
      container.appendChild(cardEl);
    }

    document.getElementById('correct-btn').onclick = () => {
      const key = currentCard.hebrew;
      stats[key] = stats[key] || { pass: 0, fail: 0 };
      stats[key].pass += 1;
      renderCard(pickNextCard());
    };

    document.getElementById('wrong-btn').onclick = () => {
      const key = currentCard.hebrew;
      stats[key] = stats[key] || { pass: 0, fail: 0 };
      stats[key].fail += 1;
      renderCard(pickNextCard());
    };

    document.getElementById('speak-btn').onclick = () => {
      if ('speechSynthesis' in window) {
        const utter = new SpeechSynthesisUtterance(currentCard.hebrew);
        utter.lang = 'he-IL';
        speechSynthesis.speak(utter);
      }
    };

    document.getElementById('settings-btn').onclick = () => {
      const menu = document.getElementById('settings-menu');
      menu.style.display = menu.style.display === 'none' ? 'block' : 'none';
    };

    function addNewCard() {
      const input = document.getElementById('newCard').value;
      try {
        const card = JSON.parse(input);
        cards.push(card);
        localStorage.setItem('hebrewCards', JSON.stringify(cards));
        alert('Card added!');
        document.getElementById('newCard').value = '';
      } catch (e) {
        alert('Invalid JSON');
      }
    }

    document.getElementById('export-btn').onclick = () => {
      const blob = new Blob([JSON.stringify(cards, null, 2)], { type: 'application/json' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = 'hebrew_cards.json';
      link.click();
    };

    document.getElementById('import-btn').onclick = () => {
      document.getElementById('importFile').click();
    };

    document.getElementById('importFile').onchange = (e) => {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function(evt) {
        try {
          cards = JSON.parse(evt.target.result);
          localStorage.setItem('hebrewCards', JSON.stringify(cards));
          alert('Import successful!');
          renderCard(pickNextCard());
        } catch (e) {
          alert('Invalid file!');
        }
      };
      reader.readAsText(file);
    };

    // Start
    renderCard(pickNextCard());

    // Register Service Worker (PWA Prep)
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js').catch(console.error);
    }
  </script>

</body>
</html>
